# Configuration

## Configuring LCLStreamer

The behavior of the LCLStreamer application is fully determined by the content of its
configuration file.

LCLStreamer reads the `lclstreamer` section of the configuration files to determine
which implementation of each component should be used. For example:

``` yaml
lclstreamer:
  [...]
  event_source: Psana1EventSource
  processing_pipeline: NoOpProcessingPipeline
  data_serializer: Hdf5Serializer
  data_handlers:
    - BinaryFileWritingDataHandler
    - BinaryDataStreamingDataHandler
```

Each component entry in this section of the configuration file identifies a python
class that implements the operations required by the component. For example, in this
case LCLStream will read psana1 data (`Psana1EventSource`), will not perform any
processing on it (`NoOpProcessingPipeline'), will serialize the data in a binary blob
with the internal structure of an HDF5 file (Hdf5Serializer) and will finally hand the
binary blob to two data handlers: one that saves it as a file
(`BinaryFileWritingDataHandler`) and one that streams it through a network socket
(`BinaryDataStreamingDataHandler`)


## Configuring LCLStreamer's components

Configuration options for each of the Python classes used by LCLStream are defined with
by an entry with the same name as the class in the relevant section of the
configuration file (the `event source`, `processing_pipeline`, `data_serializer`, or
`data_handlers` section, depending on the component that the class defines)

For example, the configuration parameters for the `Hdf5Serializer` class, which
implements the `data serializer` component, are defined by the `Hdf5Serializer` entry
in the `data_serializer` section of the configuration file:

``` yaml
data_serializer:
    Hdf5Serializer:
        compression_level: 3
        compression: zfp
        fields:
            timestamp: /data/timestamp
            detector_data: /data/data
```

One entry per each of the classes selected in the ```lclstreamer`` section must be
present int he configuration file (in the relevant portion). The entry must be present
even if the class takes no configuration options. In that case, the following syntax
must be used:

``` yaml
processing_pipeline:
    NoOpProcessingPipeline: {}
```


## Configuring the data sources

The `data_sources` section of the configuration file defines the data that LCLStreamer
extracts from every event being processed. If a piece of information is part of the
data event, but not included in the `data_sources` section, LCLStream ignores it.

The `data sources` section of the configuration file consists of a dictionary of data
sources. Each entry has a key, which acts as a name that identifies the extracted data
throughout the whole length of the LCLStream data workflow. The entry also has a value,
which consists in a nested dictonary. This inner dictionary defines the nature of the
data source (via the mandatory `type` entry) and any other parameters needed to
configure it. The `type` of a data source is the name of the Python class that
implements it. For example:

``` yaml
data_sources:
    timestamp:
        type: Psana1Timestamp

    detector_data:
        type: Psana1AreaDetector
        psana_name: Jungfrau1M
        calibration: true
```

This snippet of the configuration files defined two data sources, one called
`timestamp` and one called `detector_data`.  The `timestamp` data class is of type
`Psana1Timestamp` (A Python class of the same name determines how this type of data is
extracted from a data event). The `detector_data` class is instead of type
`Psana1AreaDetector`. The two configuration parameters `psana_name` and `calibration`
are passed to the Python class `Psana1AreaDetector` that defines how this type of data
is retrieved.


## Available Event Sources, Processing Pipelines, Data Handlers and Data Sources

* For a list of all available Event Source python classes, and their configuration
  parameters, see [here][04. configuration_event_sources]

* For a list of all available Processing Pipeline classes, and their configuration
  parameters, see [here][05. configuration_processing_pipelines]

* For a list of all available Serializer classes, and their configuration
  parameters, see [here][06. configuration_data_serializers]

* For a list of all available Data Handler classes, and their configuration
  parameters, see [here][07. configuration_data_handlers]

* For a list of all available Data Source classes, and their configuration parameters,
  see [here][08. configuration_data_sources]
